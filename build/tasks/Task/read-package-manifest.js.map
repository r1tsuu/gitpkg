{"version":3,"file":"read-package-manifest.js","names":["readFile","bluebird","promisify","fs","readPackageManifest","pkgPath","packagePath","path","resolve","pkg","JSON","parse","scripts","publishConfig","Object","keys","forEach","key","value","validatePackageJSON","name","Error","version","semver","valid"],"sources":["../../../src/tasks/Task/read-package-manifest.js"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport bluebird from 'bluebird';\nimport semver from 'semver';\n\nconst readFile = bluebird.promisify(fs.readFile);\n\nexport default async function readPackageManifest(pkgPath) {\n  const packagePath = path.resolve(pkgPath, 'package.json');\n  const pkg = JSON.parse(await readFile(packagePath, 'utf-8'));\n\n  pkg.scripts = pkg.scripts || {};\n\n  if (pkg.publishConfig) {\n    Object.keys(pkg.publishConfig).forEach(([key, value]) => {\n      pkg[key] = value;\n    });\n  }\n\n  validatePackageJSON(pkg);\n  return pkg;\n}\n\nfunction validatePackageJSON(pkg) {\n  if (!pkg.name) {\n    throw new Error(\"Package doesn't have a name.\");\n  }\n\n  if (!pkg.version) {\n    throw new Error(\"Package doesn't have a version.\");\n  }\n\n  if (!semver.valid(pkg.version)) {\n    throw new Error('Invalid semver version.');\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,QAAQ,GAAGC,iBAAA,CAASC,SAAT,CAAmBC,WAAA,CAAGH,QAAtB,CAAjB;;AAEe,eAAeI,mBAAf,CAAmCC,OAAnC,EAA4C;EACzD,MAAMC,WAAW,GAAGC,aAAA,CAAKC,OAAL,CAAaH,OAAb,EAAsB,cAAtB,CAApB;;EACA,MAAMI,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAW,MAAMX,QAAQ,CAACM,WAAD,EAAc,OAAd,CAAzB,CAAZ;EAEAG,GAAG,CAACG,OAAJ,GAAcH,GAAG,CAACG,OAAJ,IAAe,EAA7B;;EAEA,IAAIH,GAAG,CAACI,aAAR,EAAuB;IACrBC,MAAM,CAACC,IAAP,CAAYN,GAAG,CAACI,aAAhB,EAA+BG,OAA/B,CAAuC,CAAC,CAACC,GAAD,EAAMC,KAAN,CAAD,KAAkB;MACvDT,GAAG,CAACQ,GAAD,CAAH,GAAWC,KAAX;IACD,CAFD;EAGD;;EAEDC,mBAAmB,CAACV,GAAD,CAAnB;EACA,OAAOA,GAAP;AACD;;AAED,SAASU,mBAAT,CAA6BV,GAA7B,EAAkC;EAChC,IAAI,CAACA,GAAG,CAACW,IAAT,EAAe;IACb,MAAM,IAAIC,KAAJ,CAAU,8BAAV,CAAN;EACD;;EAED,IAAI,CAACZ,GAAG,CAACa,OAAT,EAAkB;IAChB,MAAM,IAAID,KAAJ,CAAU,iCAAV,CAAN;EACD;;EAED,IAAI,CAACE,eAAA,CAAOC,KAAP,CAAaf,GAAG,CAACa,OAAjB,CAAL,EAAgC;IAC9B,MAAM,IAAID,KAAJ,CAAU,yBAAV,CAAN;EACD;AACF"}